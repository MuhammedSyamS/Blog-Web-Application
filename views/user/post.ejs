<%- include('../partials/header', { title: post.title }) %>

<div class="container mt-4 post-page">

  <!-- Back button -->
  <a href="/home" class="btn btn-light mb-3">← Back to Home</a>

  <!-- Post Card -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h2 class="card-title"><%= post.title %></h2>
      <p class="text-muted mb-1">
        By <strong><%= post.author ? post.author.name : 'Unknown' %></strong>
        on <%= new Date(post.createdAt).toLocaleDateString() %>
      </p>
      <hr>

      <!-- Post content -->
      <p class="card-text" style="white-space: pre-line;"><%= post.content %></p>

      <!-- Like Button -->
      <form action="/like/<%= post._id %>" method="POST" style="display:inline;">
        <button type="submit" class="btn btn-outline-primary btn-sm">
          ❤️ Like (<%= likesCount %>)
        </button>
      </form>
    </div>
  </div>

  <!-- Comments Section -->
  <div class="card shadow-sm">
    <div class="card-header bg-light">
      <h4 class="mb-0">Comments (<%= comments.length %>)</h4>
    </div>
    <div class="card-body">

      <% if (comments.length > 0) { %>
        <% comments.forEach(comment => { %>
          <div class="border-bottom mb-3 pb-2">
            <strong><%= comment.user ? comment.user.name : 'Anonymous' %>:</strong>
            <p class="mb-0"><%= comment.content %></p>
            <small class="text-muted"><%= new Date(comment.createdAt).toLocaleString() %></small>
          </div>
        <% }) %>
      <% } else { %>
        <p>No comments yet.</p>
      <% } %>

      <!-- Add Comment Form -->
      <form action="/comment/<%= post._id %>" method="POST" class="mt-3">
        <div class="form-group">
          <textarea name="content" class="form-control" placeholder="Write a comment..." rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary mt-2">Post Comment</button>
      </form>
    </div>
  </div>

</div>

<%- include('../partials/footer') %>
