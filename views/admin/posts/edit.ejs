<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title || 'Edit Post' %></title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Bootstrap Icons -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    rel="stylesheet"
  />

  <style>
    body {
      background-color: #f8f9fa;
      font-family: "Inter", "Segoe UI", sans-serif;
    }

    .card {
      border: none;
      border-radius: 1rem;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.07);
    }

    h2 {
      font-weight: 700;
      color: #0d6efd;
    }

    .form-label {
      font-weight: 600;
    }

    .form-control, .form-select {
      border-radius: 0.6rem;
      border: 1px solid #ced4da;
      transition: all 0.2s;
    }

    .form-control:focus, .form-select:focus {
      border-color: #0d6efd;
      box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    }

    .img-preview {
      transition: transform 0.2s ease;
    }

    .img-preview:hover {
      transform: scale(1.05);
    }

    .btn-primary {
      background: linear-gradient(90deg, #0d6efd, #0b5ed7);
      border: none;
    }

    .btn-outline-secondary {
      border-radius: 50px;
    }

    .text-muted {
      font-size: 0.9rem;
    }
  </style>
</head>

<body>
  <!-- Admin Navbar -->
  <%- include('../../partials/admin_nav') %>

  <div class="container py-5">
    <!-- Header Section -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2><i class="bi bi-pencil-square me-2"></i>Edit Post</h2>
        <p class="text-muted">Refine your content and update it instantly.</p>
      </div>
      <a href="/admin/posts" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left-circle me-1"></i> Back to Posts
      </a>
    </div>

    <!-- Edit Post Card -->
    <div class="card p-4">
      <form
        action="/admin/posts/<%= post._id %>?_method=PUT"
        method="POST"
        enctype="multipart/form-data"
      >
        <!-- Title -->
        <div class="mb-4">
          <label for="title" class="form-label">Post Title</label>
          <input
            type="text"
            id="title"
            name="title"
            class="form-control form-control-lg"
            placeholder="Enter your post title"
            value="<%= post.title %>"
            required
          />
        </div>

        <!-- Existing Images -->
        <% if (post.images && post.images.length > 0) { %>
        <div class="mb-4">
          <label class="form-label">Existing Images</label>
          <div class="d-flex flex-wrap gap-3">
            <% post.images.forEach(function(img) { %>
            <div class="border rounded text-center p-2 shadow-sm" style="width: 130px;">
              <img
                src="/uploads/posts/<%= img %>"
                class="img-fluid rounded img-preview mb-2"
                alt="Existing image"
                style="height: 90px; object-fit: cover; width: 100%;"
              />
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="removeImages[]"
                  value="<%= img %>"
                  id="remove_<%= img %>"
                />
                <label for="remove_<%= img %>" class="form-check-label small text-muted">
                  Remove
                </label>
              </div>
            </div>
            <% }) %>
          </div>
        </div>
        <% } %>

        <!-- Upload New Images -->
        <div class="mb-4">
          <label for="newImages" class="form-label">
            <i class="bi bi-upload me-1"></i> Upload New Images
          </label>
          <input
            type="file"
            id="newImages"
            name="newImages"
            class="form-control"
            multiple
            accept="image/*"
          />
          <small class="text-muted">
            You can upload multiple images at once (JPG, PNG, GIF).
          </small>
        </div>

        <!-- Content -->
        <div class="mb-4">
          <label for="content" class="form-label">
            <i class="bi bi-text-paragraph me-1"></i> Content
          </label>
          <textarea
            id="content"
            name="content"
            class="form-control"
            rows="8"
            placeholder="Write something engaging..."
            required
          ><%= post.content %></textarea>
        </div>

        <!-- Status -->
        <div class="mb-4">
          <label for="status" class="form-label">
            <i class="bi bi-flag me-1"></i> Status
          </label>
          <select id="status" name="status" class="form-select form-select-lg">
            <option value="published" <%= post.status === 'published' ? 'selected' : '' %>>
              ‚úÖ Published
            </option>
            <option value="draft" <%= post.status === 'draft' ? 'selected' : '' %>>
              üìù Draft
            </option>
            <option value="pending" <%= post.status === 'pending' ? 'selected' : '' %>>
              ‚è≥ Pending
            </option>
          </select>
        </div>

        <!-- Submit -->
        <div class="text-end">
          <button
            type="submit"
            class="btn btn-primary btn-lg px-4 rounded-pill shadow-sm"
          >
            <i class="bi bi-save me-2"></i> Update Post
          </button>
        </div>
      </form>
    </div>
  </div>

  <%- include('../../partials/footer') %>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
